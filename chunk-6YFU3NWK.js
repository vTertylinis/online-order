import{a as ae}from"./chunk-4JTLKI2R.js";import{a as se}from"./chunk-NDFJONPZ.js";import{A as I,Aa as z,B as w,Da as J,Ea as Y,F as u,Fa as X,G as S,Ia as Z,J as x,K as P,Ka as $,L as D,Oa as ee,Pa as te,Ra as ne,S as L,Sa as oe,U as F,Va as ie,W as T,Ya as re,_ as k,b as M,d as g,ea as f,fa as O,ga as G,ha as N,ia as V,j as d,ja as K,ka as W,m as b,ma as q,na as j,o as C,oa as H,q as c,r,ra as Q,s as o,t as B,ta as R,ua as U,x as A,y,z as E}from"./chunk-2X3I7NOZ.js";import"./chunk-447CKG3T.js";import"./chunk-CDZFCBFW.js";import"./chunk-E2CLONXR.js";import"./chunk-KRDHHS7Z.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-LRFGNCHE.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as v,e as h}from"./chunk-JHI3MBHO.js";var ue={production:!1,googleMapsApiKey:"AIzaSyDhKTaP09AGWGYGDGbDvgWD_EBoL-X7-w0"};var le=(()=>{let i=class i{load(){return typeof window<"u"&&window.google&&window.google.maps?Promise.resolve():this.loadPromise?this.loadPromise:(this.loadPromise=new Promise((a,n)=>{let e=ue.googleMapsApiKey;(!e||e.includes("YOUR_"))&&console.error("Google Maps API key is not set. Update environments.");let s="google-maps-js",m=document.getElementById(s);if(m){m.addEventListener("load",()=>a()),m.addEventListener("error",()=>n(new Error("Google Maps failed to load")));return}let l=document.createElement("script");l.id=s,l.async=!0,l.defer=!0,l.src=`https://maps.googleapis.com/maps/api/js?key=${e}&libraries=places`,l.onload=()=>a(),l.onerror=()=>n(new Error("Google Maps failed to load")),document.head.appendChild(l)}),this.loadPromise)}};i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"});let t=i;return t})();var me=["mapElement"];function ce(t,i){if(t&1&&(r(0,"ion-item")(1,"ion-label",19)(2,"p")(3,"strong"),u(4,"\u0395\u03C0\u03B9\u03BB\u03B5\u03B3\u03BC\u03AD\u03BD\u03B7 \u03A4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C3\u03AF\u03B1:"),o()(),r(5,"p"),u(6),o()()()),t&2){let p=y(2);d(6),S(p.selectedAddress||"Lat: "+p.selectedLocation.lat+", Lng: "+p.selectedLocation.lng)}}function pe(t,i){if(t&1&&(r(0,"div",16),B(1,"div",17,0),r(3,"ion-note",18),u(4,"\u03A0\u03AC\u03C4\u03B7\u03C3\u03B5 \u03C3\u03C4\u03BF \u03C7\u03AC\u03C1\u03C4\u03B7 \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03B5\u03C0\u03B9\u03BB\u03AD\u03BE\u03B5\u03B9\u03C2 \u03C4\u03B7\u03BD \u03C4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C3\u03AF\u03B1 \u03C3\u03BF\u03C5"),o(),C(5,ce,7,1,"ion-item",9),o()),t&2){let p=y();d(5),c("ngIf",p.selectedLocation)}}function ge(t,i){t&1&&(r(0,"ion-note",21),u(1," \u03A5\u03C0\u03BF\u03C7\u03C1\u03B5\u03C9\u03C4\u03B9\u03BA\u03CC \u03C0\u03B5\u03B4\u03AF\u03BF. "),o())}function fe(t,i){if(t&1&&(r(0,"div")(1,"ion-item")(2,"ion-label",10),u(3,"\u0394\u03B9\u03B5\u03CD\u03B8\u03C5\u03BD\u03C3\u03B7"),o(),B(4,"ion-input",20),o(),C(5,ge,2,0,"ion-note",13),o()),t&2){let p=y();d(5),c("ngIf",p.form.controls.address.invalid&&p.form.controls.address.touched)}}function Ce(t,i){t&1&&(r(0,"ion-note",21),u(1," \u03A5\u03C0\u03BF\u03C7\u03C1\u03B5\u03C9\u03C4\u03B9\u03BA\u03CC \u03C0\u03B5\u03B4\u03AF\u03BF. "),o())}function Be(t,i){t&1&&(r(0,"ion-note",21),u(1," \u0395\u03B9\u03C3\u03AC\u03B3\u03B5\u03C4\u03B5 \u03AD\u03B3\u03BA\u03C5\u03C1\u03BF \u03B1\u03C1\u03B9\u03B8\u03BC\u03CC \u03BA\u03B9\u03BD\u03B7\u03C4\u03BF\u03CD. "),o())}var ke=(()=>{let i=class i{constructor(){this.fb=g(q),this.router=g(k),this.toastCtrl=g(oe),this.alertCtrl=g(ne),this.http=g(T),this.cartService=g(se),this.mapsLoader=g(le),this.addressMode="manual",this.form=this.fb.group({address:["",[f.required,f.minLength(3)]],floor:[""],name:["",[f.required]],phone:["",[f.required,f.pattern(/^\+?[0-9]{9,14}$/)]]})}ngAfterViewInit(){return h(this,null,function*(){this.addressMode==="map"&&(yield this.initMap())})}onAddressModeChange(){return h(this,null,function*(){this.addressMode==="map"?(setTimeout(()=>h(this,null,function*(){yield this.initMap()}),100),this.form.controls.address.clearValidators(),this.form.controls.address.updateValueAndValidity()):(this.form.controls.address.setValidators([f.required,f.minLength(3)]),this.form.controls.address.updateValueAndValidity())})}initMap(){return h(this,null,function*(){if(!this.mapElement||!this.mapElement.nativeElement)return;try{yield this.mapsLoader.load()}catch(e){console.error("Google Maps JavaScript API failed to load",e);return}let n={center:{lat:40.3983,lng:23.8775},zoom:15,mapTypeId:google.maps.MapTypeId.SATELLITE,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,styles:[{featureType:"poi.business",stylers:[{visibility:"off"}]}]};this.map=new google.maps.Map(this.mapElement.nativeElement,n),navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{let s={lat:e.coords.latitude,lng:e.coords.longitude};this.map?.setCenter(s)},e=>{console.log("Error getting location:",e)}),this.map&&this.map.addListener("click",e=>{e.latLng&&this.placeMarker(e.latLng)})})}placeMarker(a){this.marker&&this.marker.setMap(null),this.marker=new google.maps.Marker({position:a,map:this.map,draggable:!0}),this.selectedLocation={lat:a.lat(),lng:a.lng()},this.marker&&this.marker.addListener("dragend",n=>{n.latLng&&(this.selectedLocation={lat:n.latLng.lat(),lng:n.latLng.lng()},this.reverseGeocode(n.latLng))}),this.reverseGeocode(a)}reverseGeocode(a){new google.maps.Geocoder().geocode({location:a},(e,s)=>{s==="OK"&&e&&e[0]?(this.selectedAddress=e[0].formatted_address,this.form.patchValue({address:this.selectedAddress})):(this.selectedAddress=void 0,console.error("Geocoder failed:",s))})}submit(){return h(this,null,function*(){if(this.form.invalid){yield(yield this.toastCtrl.create({message:"\u03A0\u03B1\u03C1\u03B1\u03BA\u03B1\u03BB\u03CE \u03C3\u03C5\u03BC\u03C0\u03BB\u03B7\u03C1\u03CE\u03C3\u03C4\u03B5 \u03CC\u03BB\u03B1 \u03C4\u03B1 \u03B1\u03C0\u03B1\u03B9\u03C4\u03BF\u03CD\u03BC\u03B5\u03BD\u03B1 \u03C0\u03B5\u03B4\u03AF\u03B1.",duration:2e3,color:"danger"})).present();return}if(!ae()){yield(yield this.alertCtrl.create({header:"\u0395\u03BA\u03C4\u03CC\u03C2 \u03A9\u03C1\u03B1\u03C1\u03AF\u03BF\u03C5 \u03A0\u03B1\u03C1\u03AC\u03B4\u03BF\u03C3\u03B7\u03C2",message:"\u039F\u03B9 \u03C0\u03B1\u03C1\u03B1\u03B4\u03CC\u03C3\u03B5\u03B9\u03C2 \u03B3\u03AF\u03BD\u03BF\u03BD\u03C4\u03B1\u03B9 \u03B1\u03C0\u03CC \u03C4\u03B9\u03C2 09:00 \u03C4\u03BF \u03C0\u03C1\u03C9\u03AF \u03AD\u03C9\u03C2 \u03C4\u03B1 \u03BC\u03B5\u03C3\u03AC\u03BD\u03C5\u03C7\u03C4\u03B1 (00:00). \u03A0\u03B1\u03C1\u03B1\u03BA\u03B1\u03BB\u03BF\u03CD\u03BC\u03B5 \u03B5\u03C0\u03B9\u03C3\u03BA\u03B5\u03C6\u03B8\u03B5\u03AF\u03C4\u03B5 \u03BC\u03B1\u03C2 \u03BE\u03B1\u03BD\u03AC \u03BA\u03B1\u03C4\u03AC \u03C4\u03B9\u03C2 \u03CE\u03C1\u03B5\u03C2 \u03BB\u03B5\u03B9\u03C4\u03BF\u03C5\u03C1\u03B3\u03AF\u03B1\u03C2 \u03BC\u03B1\u03C2.",buttons:["OK"]})).present();return}let a=this.form.value,n=this.cartService.getItems(),e=this.cartService.getTotal(),s=v(v({},a),this.addressMode==="map"&&this.selectedLocation?{location:this.selectedLocation,addressType:"map"}:{addressType:"manual"});try{localStorage.setItem("checkout_address",JSON.stringify(s))}catch{}let m={address:s,cart:n,total:e,timestamp:new Date().toISOString()};try{console.log("Sending order data:",m);let l=yield this.http.post("https://unepigrammatic-harshly-dario.ngrok-free.dev/order",m).toPromise();console.log("Order sent successfully:",l);let _=yield this.alertCtrl.create({header:"\u0395\u03C0\u03B9\u03C4\u03C5\u03C7\u03AF\u03B1",message:"\u039B\u03AC\u03B2\u03B1\u03BC\u03B5 \u03BC\u03B5 \u03B5\u03C0\u03B9\u03C4\u03C5\u03C7\u03AF\u03B1 \u03C4\u03B7\u03BD \u03C0\u03B1\u03C1\u03B1\u03B3\u03B3\u03B5\u03BB\u03AF\u03B1 \u03C3\u03B1\u03C2 \u03BA\u03B1\u03B9 \u03B8\u03B1 \u03B5\u03C0\u03B9\u03BA\u03BF\u03B9\u03BD\u03C9\u03BD\u03AE\u03C3\u03BF\u03C5\u03BC\u03B5 \u03BC\u03B1\u03B6\u03AF \u03C3\u03B1\u03C2 \u03B3\u03B9\u03B1 \u03B5\u03C0\u03B9\u03B2\u03B5\u03B2\u03B1\u03AF\u03C9\u03C3\u03B7.",buttons:["OK"]});yield _.present(),yield _.onDidDismiss()}catch(l){console.error("Error sending order:",l),yield(yield this.toastCtrl.create({message:"\u03A3\u03C6\u03AC\u03BB\u03BC\u03B1 \u03B1\u03C0\u03BF\u03C3\u03C4\u03BF\u03BB\u03AE\u03C2 \u03C0\u03B1\u03C1\u03B1\u03B3\u03B3\u03B5\u03BB\u03AF\u03B1\u03C2. \u0395\u03BB\u03AD\u03B3\u03BE\u03C4\u03B5 \u03C4\u03B7 \u03C3\u03CD\u03BD\u03B4\u03B5\u03C3\u03B7.",duration:3e3,color:"warning"})).present(),this.router.navigateByUrl("/");return}this.router.navigateByUrl("/")})}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=b({type:i,selectors:[["app-address"]],viewQuery:function(n,e){if(n&1&&E(me,5),n&2){let s;I(s=w())&&(e.mapElement=s.first)}},decls:33,vars:7,consts:[["mapElement",""],["slot","start"],["defaultHref","/cart"],[1,"ion-padding"],[3,"ngModelChange","ionChange","ngModel"],["value","manual"],["value","map"],["class","map-container",4,"ngIf"],[3,"ngSubmit","formGroup"],[4,"ngIf"],["position","floating"],["formControlName","floor","inputmode","numeric"],["formControlName","name","inputmode","text"],["color","danger",4,"ngIf"],["formControlName","phone","type","tel","inputmode","tel"],["expand","block","type","submit",1,"submit-btn",3,"disabled"],[1,"map-container"],[1,"map"],[1,"map-instruction"],[1,"ion-text-wrap"],["formControlName","address","inputmode","text"],["color","danger"]],template:function(n,e){n&1&&(r(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),B(3,"ion-back-button",2),o(),r(4,"ion-title"),u(5,"\u0394\u03B9\u03B5\u03CD\u03B8\u03C5\u03BD\u03C3\u03B7"),o()()(),r(6,"ion-content",3)(7,"ion-segment",4),D("ngModelChange",function(m){return P(e.addressMode,m)||(e.addressMode=m),m}),A("ionChange",function(){return e.onAddressModeChange()}),r(8,"ion-segment-button",5)(9,"ion-label"),u(10,"\u0393\u03C1\u03AC\u03C8\u03B5 \u0394\u03B9\u03B5\u03CD\u03B8\u03C5\u03BD\u03C3\u03B7"),o()(),r(11,"ion-segment-button",6)(12,"ion-label"),u(13,"\u03A7\u03AC\u03C1\u03C4\u03B7\u03C2"),o()()(),C(14,pe,6,1,"div",7),r(15,"form",8),A("ngSubmit",function(){return e.submit()}),C(16,fe,6,1,"div",9),r(17,"ion-item")(18,"ion-label",10),u(19,"\u038C\u03C1\u03BF\u03C6\u03BF\u03C2"),o(),B(20,"ion-input",11),o(),r(21,"ion-item")(22,"ion-label",10),u(23,"\u038C\u03BD\u03BF\u03BC\u03B1"),o(),B(24,"ion-input",12),o(),C(25,Ce,2,0,"ion-note",13),r(26,"ion-item")(27,"ion-label",10),u(28,"\u039A\u03B9\u03BD\u03B7\u03C4\u03CC"),o(),B(29,"ion-input",14),o(),C(30,Be,2,0,"ion-note",13),r(31,"ion-button",15),u(32,"\u0391\u03C0\u03BF\u03C3\u03C4\u03BF\u03BB\u03AE \u03C0\u03B1\u03C1\u03B1\u03B3\u03B3\u03B5\u03BB\u03AF\u03B1\u03C2"),o()()()),n&2&&(d(7),x("ngModel",e.addressMode),d(7),c("ngIf",e.addressMode==="map"),d(),c("formGroup",e.form),d(),c("ngIf",e.addressMode==="manual"),d(9),c("ngIf",e.form.controls.name.invalid&&e.form.controls.name.touched),d(5),c("ngIf",e.form.controls.phone.invalid&&e.form.controls.phone.touched),d(),c("disabled",e.form.invalid||e.addressMode==="map"&&!e.selectedLocation))},dependencies:[F,L,j,V,O,G,N,H,K,W,J,te,U,Q,ee,z,Y,X,ie,Z,R,re,$],styles:[".submit-btn[_ngcontent-%COMP%]{margin-top:16px}ion-note[_ngcontent-%COMP%]{margin-left:16px}ion-segment[_ngcontent-%COMP%]{margin-bottom:20px}.map-container[_ngcontent-%COMP%]{margin:20px 0}.map-container[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{width:100%;height:400px;border-radius:8px;margin-bottom:10px}.map-container[_ngcontent-%COMP%]   .map-instruction[_ngcontent-%COMP%]{display:block;text-align:center;margin:10px 0;font-size:.9rem}.map-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin-top:10px}"]});let t=i;return t})();export{ke as AddressPage};
