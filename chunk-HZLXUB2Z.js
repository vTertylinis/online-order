import{a as re}from"./chunk-4JTLKI2R.js";import{a as ae}from"./chunk-ZO2B4BGA.js";import{Aa as U,Ba as j,C as r,Ca as X,D as I,Fa as Y,G as x,H as F,Ha as Z,I as w,La as $,Ma as ee,Oa as te,P as D,Pa as ne,R as L,Sa as oe,T as P,Va as ie,X as T,b as p,ba as c,ca as O,da as k,ea as N,fa as V,ga as G,h as l,ha as q,ja as H,k as M,ka as Q,la as W,m as g,n as d,o as n,oa as K,p as t,q as C,qa as R,ra as z,u as v,v as h,w as b,x as S,xa as J,y as E}from"./chunk-IBLYHQFS.js";import"./chunk-447CKG3T.js";import"./chunk-CDZFCBFW.js";import"./chunk-E2CLONXR.js";import"./chunk-KRDHHS7Z.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-LRFGNCHE.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as A,e as y}from"./chunk-JHI3MBHO.js";var se=["mapElement"];function ue(o,s){if(o&1&&(n(0,"ion-item")(1,"ion-label",19)(2,"p")(3,"strong"),r(4,"\u0395\u03C0\u03B9\u03BB\u03B5\u03B3\u03BC\u03AD\u03BD\u03B7 \u03A4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C3\u03AF\u03B1:"),t()(),n(5,"p"),r(6),t()()()),o&2){let m=h(2);l(6),I(m.selectedAddress||"Lat: "+m.selectedLocation.lat+", Lng: "+m.selectedLocation.lng)}}function le(o,s){if(o&1&&(n(0,"div",16),C(1,"div",17,0),n(3,"ion-note",18),r(4,"\u03A0\u03AC\u03C4\u03B7\u03C3\u03B5 \u03C3\u03C4\u03BF \u03C7\u03AC\u03C1\u03C4\u03B7 \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03B5\u03C0\u03B9\u03BB\u03AD\u03BE\u03B5\u03B9\u03C2 \u03C4\u03B7\u03BD \u03C4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C3\u03AF\u03B1 \u03C3\u03BF\u03C5"),t(),g(5,ue,7,1,"ion-item",9),t()),o&2){let m=h();l(5),d("ngIf",m.selectedLocation)}}function de(o,s){o&1&&(n(0,"ion-note",21),r(1," \u03A5\u03C0\u03BF\u03C7\u03C1\u03B5\u03C9\u03C4\u03B9\u03BA\u03CC \u03C0\u03B5\u03B4\u03AF\u03BF. "),t())}function me(o,s){if(o&1&&(n(0,"div")(1,"ion-item")(2,"ion-label",10),r(3,"\u0394\u03B9\u03B5\u03CD\u03B8\u03C5\u03BD\u03C3\u03B7"),t(),C(4,"ion-input",20),t(),g(5,de,2,0,"ion-note",13),t()),o&2){let m=h();l(5),d("ngIf",m.form.controls.address.invalid&&m.form.controls.address.touched)}}function ce(o,s){o&1&&(n(0,"ion-note",21),r(1," \u03A5\u03C0\u03BF\u03C7\u03C1\u03B5\u03C9\u03C4\u03B9\u03BA\u03CC \u03C0\u03B5\u03B4\u03AF\u03BF. "),t())}function pe(o,s){o&1&&(n(0,"ion-note",21),r(1," \u0395\u03B9\u03C3\u03AC\u03B3\u03B5\u03C4\u03B5 \u03AD\u03B3\u03BA\u03C5\u03C1\u03BF \u03B1\u03C1\u03B9\u03B8\u03BC\u03CC \u03BA\u03B9\u03BD\u03B7\u03C4\u03BF\u03CD. "),t())}var xe=(()=>{let s=class s{constructor(){this.fb=p(H),this.router=p(T),this.toastCtrl=p(ne),this.alertCtrl=p(te),this.http=p(P),this.cartService=p(ae),this.addressMode="manual",this.form=this.fb.group({address:["",[c.required,c.minLength(3)]],floor:[""],name:["",[c.required]],phone:["",[c.required,c.pattern(/^\+?[0-9]{9,14}$/)]]})}ngAfterViewInit(){this.addressMode==="map"&&this.initMap()}onAddressModeChange(){this.addressMode==="map"?(setTimeout(()=>{this.initMap()},100),this.form.controls.address.clearValidators(),this.form.controls.address.updateValueAndValidity()):(this.form.controls.address.setValidators([c.required,c.minLength(3)]),this.form.controls.address.updateValueAndValidity())}initMap(){if(!this.mapElement||!this.mapElement.nativeElement)return;if(typeof google>"u"||!google.maps){console.error("Google Maps JavaScript API not loaded");return}let i={center:{lat:40.3983,lng:23.8775},zoom:15,mapTypeId:google.maps.MapTypeId.SATELLITE,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,styles:[{featureType:"poi.business",stylers:[{visibility:"off"}]}]};this.map=new google.maps.Map(this.mapElement.nativeElement,i),navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{let a={lat:e.coords.latitude,lng:e.coords.longitude};this.map?.setCenter(a)},e=>{console.log("Error getting location:",e)}),this.map&&this.map.addListener("click",e=>{e.latLng&&this.placeMarker(e.latLng)})}placeMarker(u){this.marker&&this.marker.setMap(null),this.marker=new google.maps.Marker({position:u,map:this.map,draggable:!0}),this.selectedLocation={lat:u.lat(),lng:u.lng()},this.marker&&this.marker.addListener("dragend",i=>{i.latLng&&(this.selectedLocation={lat:i.latLng.lat(),lng:i.latLng.lng()},this.reverseGeocode(i.latLng))}),this.reverseGeocode(u)}reverseGeocode(u){new google.maps.Geocoder().geocode({location:u},(e,a)=>{a==="OK"&&e&&e[0]?(this.selectedAddress=e[0].formatted_address,this.form.patchValue({address:this.selectedAddress})):(this.selectedAddress=void 0,console.error("Geocoder failed:",a))})}submit(){return y(this,null,function*(){if(this.form.invalid){yield(yield this.toastCtrl.create({message:"\u03A0\u03B1\u03C1\u03B1\u03BA\u03B1\u03BB\u03CE \u03C3\u03C5\u03BC\u03C0\u03BB\u03B7\u03C1\u03CE\u03C3\u03C4\u03B5 \u03CC\u03BB\u03B1 \u03C4\u03B1 \u03B1\u03C0\u03B1\u03B9\u03C4\u03BF\u03CD\u03BC\u03B5\u03BD\u03B1 \u03C0\u03B5\u03B4\u03AF\u03B1.",duration:2e3,color:"danger"})).present();return}if(!re()){yield(yield this.alertCtrl.create({header:"\u0395\u03BA\u03C4\u03CC\u03C2 \u03A9\u03C1\u03B1\u03C1\u03AF\u03BF\u03C5 \u03A0\u03B1\u03C1\u03AC\u03B4\u03BF\u03C3\u03B7\u03C2",message:"\u039F\u03B9 \u03C0\u03B1\u03C1\u03B1\u03B4\u03CC\u03C3\u03B5\u03B9\u03C2 \u03B3\u03AF\u03BD\u03BF\u03BD\u03C4\u03B1\u03B9 \u03B1\u03C0\u03CC \u03C4\u03B9\u03C2 09:00 \u03C4\u03BF \u03C0\u03C1\u03C9\u03AF \u03AD\u03C9\u03C2 \u03C4\u03B1 \u03BC\u03B5\u03C3\u03AC\u03BD\u03C5\u03C7\u03C4\u03B1 (00:00). \u03A0\u03B1\u03C1\u03B1\u03BA\u03B1\u03BB\u03BF\u03CD\u03BC\u03B5 \u03B5\u03C0\u03B9\u03C3\u03BA\u03B5\u03C6\u03B8\u03B5\u03AF\u03C4\u03B5 \u03BC\u03B1\u03C2 \u03BE\u03B1\u03BD\u03AC \u03BA\u03B1\u03C4\u03AC \u03C4\u03B9\u03C2 \u03CE\u03C1\u03B5\u03C2 \u03BB\u03B5\u03B9\u03C4\u03BF\u03C5\u03C1\u03B3\u03AF\u03B1\u03C2 \u03BC\u03B1\u03C2.",buttons:["OK"]})).present();return}let u=this.form.value,i=this.cartService.getItems(),e=this.cartService.getTotal(),a=A(A({},u),this.addressMode==="map"&&this.selectedLocation?{location:this.selectedLocation,addressType:"map"}:{addressType:"manual"});try{localStorage.setItem("checkout_address",JSON.stringify(a))}catch{}let B={address:a,cart:i,total:e,timestamp:new Date().toISOString()};try{console.log("Sending order data:",B);let f=yield this.http.post("https://unepigrammatic-harshly-dario.ngrok-free.dev/order",B).toPromise();console.log("Order sent successfully:",f);let _=yield this.alertCtrl.create({header:"\u0395\u03C0\u03B9\u03C4\u03C5\u03C7\u03AF\u03B1",message:"\u039B\u03AC\u03B2\u03B1\u03BC\u03B5 \u03BC\u03B5 \u03B5\u03C0\u03B9\u03C4\u03C5\u03C7\u03AF\u03B1 \u03C4\u03B7\u03BD \u03C0\u03B1\u03C1\u03B1\u03B3\u03B3\u03B5\u03BB\u03AF\u03B1 \u03C3\u03B1\u03C2 \u03BA\u03B1\u03B9 \u03B8\u03B1 \u03B5\u03C0\u03B9\u03BA\u03BF\u03B9\u03BD\u03C9\u03BD\u03AE\u03C3\u03BF\u03C5\u03BC\u03B5 \u03BC\u03B1\u03B6\u03AF \u03C3\u03B1\u03C2 \u03B3\u03B9\u03B1 \u03B5\u03C0\u03B9\u03B2\u03B5\u03B2\u03B1\u03AF\u03C9\u03C3\u03B7.",buttons:["OK"]});yield _.present(),yield _.onDidDismiss()}catch(f){console.error("Error sending order:",f),yield(yield this.toastCtrl.create({message:"\u03A3\u03C6\u03AC\u03BB\u03BC\u03B1 \u03B1\u03C0\u03BF\u03C3\u03C4\u03BF\u03BB\u03AE\u03C2 \u03C0\u03B1\u03C1\u03B1\u03B3\u03B3\u03B5\u03BB\u03AF\u03B1\u03C2. \u0395\u03BB\u03AD\u03B3\u03BE\u03C4\u03B5 \u03C4\u03B7 \u03C3\u03CD\u03BD\u03B4\u03B5\u03C3\u03B7.",duration:3e3,color:"warning"})).present(),this.router.navigateByUrl("/");return}this.router.navigateByUrl("/")})}};s.\u0275fac=function(i){return new(i||s)},s.\u0275cmp=M({type:s,selectors:[["app-address"]],viewQuery:function(i,e){if(i&1&&b(se,5),i&2){let a;S(a=E())&&(e.mapElement=a.first)}},decls:33,vars:7,consts:[["mapElement",""],["slot","start"],["defaultHref","/cart"],[1,"ion-padding"],[3,"ngModelChange","ionChange","ngModel"],["value","manual"],["value","map"],["class","map-container",4,"ngIf"],[3,"ngSubmit","formGroup"],[4,"ngIf"],["position","floating"],["formControlName","floor","inputmode","numeric"],["formControlName","name","inputmode","text"],["color","danger",4,"ngIf"],["formControlName","phone","type","tel","inputmode","tel"],["expand","block","type","submit",1,"submit-btn",3,"disabled"],[1,"map-container"],[1,"map"],[1,"map-instruction"],[1,"ion-text-wrap"],["formControlName","address","inputmode","text"],["color","danger"]],template:function(i,e){i&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),C(3,"ion-back-button",2),t(),n(4,"ion-title"),r(5,"\u0394\u03B9\u03B5\u03CD\u03B8\u03C5\u03BD\u03C3\u03B7"),t()()(),n(6,"ion-content",3)(7,"ion-segment",4),w("ngModelChange",function(B){return F(e.addressMode,B)||(e.addressMode=B),B}),v("ionChange",function(){return e.onAddressModeChange()}),n(8,"ion-segment-button",5)(9,"ion-label"),r(10,"\u0393\u03C1\u03AC\u03C8\u03B5 \u0394\u03B9\u03B5\u03CD\u03B8\u03C5\u03BD\u03C3\u03B7"),t()(),n(11,"ion-segment-button",6)(12,"ion-label"),r(13,"\u03A7\u03AC\u03C1\u03C4\u03B7\u03C2"),t()()(),g(14,le,6,1,"div",7),n(15,"form",8),v("ngSubmit",function(){return e.submit()}),g(16,me,6,1,"div",9),n(17,"ion-item")(18,"ion-label",10),r(19,"\u038C\u03C1\u03BF\u03C6\u03BF\u03C2"),t(),C(20,"ion-input",11),t(),n(21,"ion-item")(22,"ion-label",10),r(23,"\u038C\u03BD\u03BF\u03BC\u03B1"),t(),C(24,"ion-input",12),t(),g(25,ce,2,0,"ion-note",13),n(26,"ion-item")(27,"ion-label",10),r(28,"\u039A\u03B9\u03BD\u03B7\u03C4\u03CC"),t(),C(29,"ion-input",14),t(),g(30,pe,2,0,"ion-note",13),n(31,"ion-button",15),r(32,"\u0391\u03C0\u03BF\u03C3\u03C4\u03BF\u03BB\u03AE \u03C0\u03B1\u03C1\u03B1\u03B3\u03B3\u03B5\u03BB\u03AF\u03B1\u03C2"),t()()()),i&2&&(l(7),x("ngModel",e.addressMode),l(7),d("ngIf",e.addressMode==="map"),l(),d("formGroup",e.form),l(),d("ngIf",e.addressMode==="manual"),l(9),d("ngIf",e.form.controls.name.invalid&&e.form.controls.name.touched),l(5),d("ngIf",e.form.controls.phone.invalid&&e.form.controls.phone.touched),l(),d("disabled",e.form.invalid||e.addressMode==="map"&&!e.selectedLocation))},dependencies:[L,D,Q,V,O,k,N,W,G,q,U,ee,z,K,$,J,j,X,oe,Y,R,ie,Z],styles:[".submit-btn[_ngcontent-%COMP%]{margin-top:16px}ion-note[_ngcontent-%COMP%]{margin-left:16px}ion-segment[_ngcontent-%COMP%]{margin-bottom:20px}.map-container[_ngcontent-%COMP%]{margin:20px 0}.map-container[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{width:100%;height:400px;border-radius:8px;margin-bottom:10px}.map-container[_ngcontent-%COMP%]   .map-instruction[_ngcontent-%COMP%]{display:block;text-align:center;margin:10px 0;font-size:.9rem}.map-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin-top:10px}"]});let o=s;return o})();export{xe as AddressPage};
