import{a as ue}from"./chunk-4JTLKI2R.js";import{a as de}from"./chunk-NDFJONPZ.js";import{a as se}from"./chunk-5VBSB3S3.js";import{A as S,Aa as J,B as I,Da as $,Ea as X,F as u,Fa as Y,G as L,Ia as Z,J as x,K as P,Ka as ee,L as F,Oa as te,Pa as ne,Ra as oe,S as D,Sa as ie,U as T,Va as re,W as k,Ya as ae,_ as O,b as w,d as c,ea as C,fa as N,ga as G,ha as V,ia as q,j as l,ja as K,ka as j,m as M,ma as H,na as Q,o as B,oa as R,q as p,r,ra as W,s as o,t as h,ta as U,ua as z,x as b,y as _,z as E}from"./chunk-2X3I7NOZ.js";import"./chunk-447CKG3T.js";import"./chunk-CDZFCBFW.js";import"./chunk-E2CLONXR.js";import"./chunk-KRDHHS7Z.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-LRFGNCHE.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as A,e as f}from"./chunk-JHI3MBHO.js";var le=(()=>{let i=class i{constructor(){this.config=c(se)}load(){return f(this,null,function*(){if(typeof window.google<"u"&&window.google.maps)return;if(window.gmapsLoaderPromise)return window.gmapsLoaderPromise;let a=(this.config.get("googleApiKey")||"").trim(),n=(this.config.get("googleMapsLibraries")||"places").trim();return window.gmapsLoaderPromise=new Promise((e,s)=>{let m=document.getElementById("gmaps-script");if(m){m.addEventListener("load",()=>e()),m.addEventListener("error",()=>s(new Error("Google Maps script failed to load")));return}let d=document.createElement("script");d.id="gmaps-script";let y="https://maps.googleapis.com/maps/api/js",v=new URLSearchParams;a&&v.set("key",a),n&&v.set("libraries",n),d.src=`${y}?${v.toString()}`,d.async=!0,d.defer=!0,d.addEventListener("load",()=>e()),d.addEventListener("error",()=>s(new Error("Google Maps script failed to load"))),document.head.appendChild(d)}),window.gmapsLoaderPromise})}};i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"});let t=i;return t})();var ce=["mapElement"];function pe(t,i){if(t&1&&(r(0,"ion-item")(1,"ion-label",19)(2,"p")(3,"strong"),u(4,"\u0395\u03C0\u03B9\u03BB\u03B5\u03B3\u03BC\u03AD\u03BD\u03B7 \u03A4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C3\u03AF\u03B1:"),o()(),r(5,"p"),u(6),o()()()),t&2){let g=_(2);l(6),L(g.selectedAddress||"Lat: "+g.selectedLocation.lat+", Lng: "+g.selectedLocation.lng)}}function ge(t,i){if(t&1&&(r(0,"div",16),h(1,"div",17,0),r(3,"ion-note",18),u(4,"\u03A0\u03AC\u03C4\u03B7\u03C3\u03B5 \u03C3\u03C4\u03BF \u03C7\u03AC\u03C1\u03C4\u03B7 \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03B5\u03C0\u03B9\u03BB\u03AD\u03BE\u03B5\u03B9\u03C2 \u03C4\u03B7\u03BD \u03C4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C3\u03AF\u03B1 \u03C3\u03BF\u03C5"),o(),B(5,pe,7,1,"ion-item",9),o()),t&2){let g=_();l(5),p("ngIf",g.selectedLocation)}}function fe(t,i){t&1&&(r(0,"ion-note",21),u(1," \u03A5\u03C0\u03BF\u03C7\u03C1\u03B5\u03C9\u03C4\u03B9\u03BA\u03CC \u03C0\u03B5\u03B4\u03AF\u03BF. "),o())}function Ce(t,i){if(t&1&&(r(0,"div")(1,"ion-item")(2,"ion-label",10),u(3,"\u0394\u03B9\u03B5\u03CD\u03B8\u03C5\u03BD\u03C3\u03B7"),o(),h(4,"ion-input",20),o(),B(5,fe,2,0,"ion-note",13),o()),t&2){let g=_();l(5),p("ngIf",g.form.controls.address.invalid&&g.form.controls.address.touched)}}function Be(t,i){t&1&&(r(0,"ion-note",21),u(1," \u03A5\u03C0\u03BF\u03C7\u03C1\u03B5\u03C9\u03C4\u03B9\u03BA\u03CC \u03C0\u03B5\u03B4\u03AF\u03BF. "),o())}function he(t,i){t&1&&(r(0,"ion-note",21),u(1," \u0395\u03B9\u03C3\u03AC\u03B3\u03B5\u03C4\u03B5 \u03AD\u03B3\u03BA\u03C5\u03C1\u03BF \u03B1\u03C1\u03B9\u03B8\u03BC\u03CC \u03BA\u03B9\u03BD\u03B7\u03C4\u03BF\u03CD. "),o())}var Ge=(()=>{let i=class i{constructor(){this.fb=c(H),this.router=c(O),this.toastCtrl=c(ie),this.alertCtrl=c(oe),this.http=c(k),this.cartService=c(de),this.mapsLoader=c(le),this.addressMode="manual",this.form=this.fb.group({address:["",[C.required,C.minLength(3)]],floor:[""],name:["",[C.required]],phone:["",[C.required,C.pattern(/^\+?[0-9]{9,14}$/)]]})}ngAfterViewInit(){return f(this,null,function*(){this.addressMode==="map"&&(yield this.initMap())})}onAddressModeChange(){return f(this,null,function*(){this.addressMode==="map"?(setTimeout(()=>f(this,null,function*(){yield this.initMap()}),100),this.form.controls.address.clearValidators(),this.form.controls.address.updateValueAndValidity()):(this.form.controls.address.setValidators([C.required,C.minLength(3)]),this.form.controls.address.updateValueAndValidity())})}initMap(){return f(this,null,function*(){if(!this.mapElement||!this.mapElement.nativeElement)return;try{yield this.mapsLoader.load()}catch(e){console.error("Google Maps JavaScript API not loaded",e);return}let n={center:{lat:40.3983,lng:23.8775},zoom:15,mapTypeId:google.maps.MapTypeId.SATELLITE,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,styles:[{featureType:"poi.business",stylers:[{visibility:"off"}]}]};this.map=new google.maps.Map(this.mapElement.nativeElement,n),navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{let s={lat:e.coords.latitude,lng:e.coords.longitude};this.map?.setCenter(s)},e=>{console.log("Error getting location:",e)}),this.map&&this.map.addListener("click",e=>{e.latLng&&this.placeMarker(e.latLng)})})}placeMarker(a){this.marker&&this.marker.setMap(null),this.marker=new google.maps.Marker({position:a,map:this.map,draggable:!0}),this.selectedLocation={lat:a.lat(),lng:a.lng()},this.marker&&this.marker.addListener("dragend",n=>{n.latLng&&(this.selectedLocation={lat:n.latLng.lat(),lng:n.latLng.lng()},this.reverseGeocode(n.latLng))}),this.reverseGeocode(a)}reverseGeocode(a){new google.maps.Geocoder().geocode({location:a},(e,s)=>{s==="OK"&&e&&e[0]?(this.selectedAddress=e[0].formatted_address,this.form.patchValue({address:this.selectedAddress})):(this.selectedAddress=void 0,console.error("Geocoder failed:",s))})}submit(){return f(this,null,function*(){if(this.form.invalid){yield(yield this.toastCtrl.create({message:"\u03A0\u03B1\u03C1\u03B1\u03BA\u03B1\u03BB\u03CE \u03C3\u03C5\u03BC\u03C0\u03BB\u03B7\u03C1\u03CE\u03C3\u03C4\u03B5 \u03CC\u03BB\u03B1 \u03C4\u03B1 \u03B1\u03C0\u03B1\u03B9\u03C4\u03BF\u03CD\u03BC\u03B5\u03BD\u03B1 \u03C0\u03B5\u03B4\u03AF\u03B1.",duration:2e3,color:"danger"})).present();return}if(!ue()){yield(yield this.alertCtrl.create({header:"\u0395\u03BA\u03C4\u03CC\u03C2 \u03A9\u03C1\u03B1\u03C1\u03AF\u03BF\u03C5 \u03A0\u03B1\u03C1\u03AC\u03B4\u03BF\u03C3\u03B7\u03C2",message:"\u039F\u03B9 \u03C0\u03B1\u03C1\u03B1\u03B4\u03CC\u03C3\u03B5\u03B9\u03C2 \u03B3\u03AF\u03BD\u03BF\u03BD\u03C4\u03B1\u03B9 \u03B1\u03C0\u03CC \u03C4\u03B9\u03C2 09:00 \u03C4\u03BF \u03C0\u03C1\u03C9\u03AF \u03AD\u03C9\u03C2 \u03C4\u03B1 \u03BC\u03B5\u03C3\u03AC\u03BD\u03C5\u03C7\u03C4\u03B1 (00:00). \u03A0\u03B1\u03C1\u03B1\u03BA\u03B1\u03BB\u03BF\u03CD\u03BC\u03B5 \u03B5\u03C0\u03B9\u03C3\u03BA\u03B5\u03C6\u03B8\u03B5\u03AF\u03C4\u03B5 \u03BC\u03B1\u03C2 \u03BE\u03B1\u03BD\u03AC \u03BA\u03B1\u03C4\u03AC \u03C4\u03B9\u03C2 \u03CE\u03C1\u03B5\u03C2 \u03BB\u03B5\u03B9\u03C4\u03BF\u03C5\u03C1\u03B3\u03AF\u03B1\u03C2 \u03BC\u03B1\u03C2.",buttons:["OK"]})).present();return}let a=this.form.value,n=this.cartService.getItems(),e=this.cartService.getTotal(),s=A(A({},a),this.addressMode==="map"&&this.selectedLocation?{location:this.selectedLocation,addressType:"map"}:{addressType:"manual"});try{localStorage.setItem("checkout_address",JSON.stringify(s))}catch{}let m={address:s,cart:n,total:e,timestamp:new Date().toISOString()};try{console.log("Sending order data:",m);let d=yield this.http.post("https://unepigrammatic-harshly-dario.ngrok-free.dev/order",m).toPromise();console.log("Order sent successfully:",d);let y=yield this.alertCtrl.create({header:"\u0395\u03C0\u03B9\u03C4\u03C5\u03C7\u03AF\u03B1",message:"\u039B\u03AC\u03B2\u03B1\u03BC\u03B5 \u03BC\u03B5 \u03B5\u03C0\u03B9\u03C4\u03C5\u03C7\u03AF\u03B1 \u03C4\u03B7\u03BD \u03C0\u03B1\u03C1\u03B1\u03B3\u03B3\u03B5\u03BB\u03AF\u03B1 \u03C3\u03B1\u03C2 \u03BA\u03B1\u03B9 \u03B8\u03B1 \u03B5\u03C0\u03B9\u03BA\u03BF\u03B9\u03BD\u03C9\u03BD\u03AE\u03C3\u03BF\u03C5\u03BC\u03B5 \u03BC\u03B1\u03B6\u03AF \u03C3\u03B1\u03C2 \u03B3\u03B9\u03B1 \u03B5\u03C0\u03B9\u03B2\u03B5\u03B2\u03B1\u03AF\u03C9\u03C3\u03B7.",buttons:["OK"]});yield y.present(),yield y.onDidDismiss()}catch(d){console.error("Error sending order:",d),yield(yield this.toastCtrl.create({message:"\u03A3\u03C6\u03AC\u03BB\u03BC\u03B1 \u03B1\u03C0\u03BF\u03C3\u03C4\u03BF\u03BB\u03AE\u03C2 \u03C0\u03B1\u03C1\u03B1\u03B3\u03B3\u03B5\u03BB\u03AF\u03B1\u03C2. \u0395\u03BB\u03AD\u03B3\u03BE\u03C4\u03B5 \u03C4\u03B7 \u03C3\u03CD\u03BD\u03B4\u03B5\u03C3\u03B7.",duration:3e3,color:"warning"})).present(),this.router.navigateByUrl("/");return}this.router.navigateByUrl("/")})}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=M({type:i,selectors:[["app-address"]],viewQuery:function(n,e){if(n&1&&E(ce,5),n&2){let s;S(s=I())&&(e.mapElement=s.first)}},decls:33,vars:7,consts:[["mapElement",""],["slot","start"],["defaultHref","/cart"],[1,"ion-padding"],[3,"ngModelChange","ionChange","ngModel"],["value","manual"],["value","map"],["class","map-container",4,"ngIf"],[3,"ngSubmit","formGroup"],[4,"ngIf"],["position","floating"],["formControlName","floor","inputmode","numeric"],["formControlName","name","inputmode","text"],["color","danger",4,"ngIf"],["formControlName","phone","type","tel","inputmode","tel"],["expand","block","type","submit",1,"submit-btn",3,"disabled"],[1,"map-container"],[1,"map"],[1,"map-instruction"],[1,"ion-text-wrap"],["formControlName","address","inputmode","text"],["color","danger"]],template:function(n,e){n&1&&(r(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),h(3,"ion-back-button",2),o(),r(4,"ion-title"),u(5,"\u0394\u03B9\u03B5\u03CD\u03B8\u03C5\u03BD\u03C3\u03B7"),o()()(),r(6,"ion-content",3)(7,"ion-segment",4),F("ngModelChange",function(m){return P(e.addressMode,m)||(e.addressMode=m),m}),b("ionChange",function(){return e.onAddressModeChange()}),r(8,"ion-segment-button",5)(9,"ion-label"),u(10,"\u0393\u03C1\u03AC\u03C8\u03B5 \u0394\u03B9\u03B5\u03CD\u03B8\u03C5\u03BD\u03C3\u03B7"),o()(),r(11,"ion-segment-button",6)(12,"ion-label"),u(13,"\u03A7\u03AC\u03C1\u03C4\u03B7\u03C2"),o()()(),B(14,ge,6,1,"div",7),r(15,"form",8),b("ngSubmit",function(){return e.submit()}),B(16,Ce,6,1,"div",9),r(17,"ion-item")(18,"ion-label",10),u(19,"\u038C\u03C1\u03BF\u03C6\u03BF\u03C2"),o(),h(20,"ion-input",11),o(),r(21,"ion-item")(22,"ion-label",10),u(23,"\u038C\u03BD\u03BF\u03BC\u03B1"),o(),h(24,"ion-input",12),o(),B(25,Be,2,0,"ion-note",13),r(26,"ion-item")(27,"ion-label",10),u(28,"\u039A\u03B9\u03BD\u03B7\u03C4\u03CC"),o(),h(29,"ion-input",14),o(),B(30,he,2,0,"ion-note",13),r(31,"ion-button",15),u(32,"\u0391\u03C0\u03BF\u03C3\u03C4\u03BF\u03BB\u03AE \u03C0\u03B1\u03C1\u03B1\u03B3\u03B3\u03B5\u03BB\u03AF\u03B1\u03C2"),o()()()),n&2&&(l(7),x("ngModel",e.addressMode),l(7),p("ngIf",e.addressMode==="map"),l(),p("formGroup",e.form),l(),p("ngIf",e.addressMode==="manual"),l(9),p("ngIf",e.form.controls.name.invalid&&e.form.controls.name.touched),l(5),p("ngIf",e.form.controls.phone.invalid&&e.form.controls.phone.touched),l(),p("disabled",e.form.invalid||e.addressMode==="map"&&!e.selectedLocation))},dependencies:[T,D,Q,q,N,G,V,R,K,j,$,ne,z,W,te,J,X,Y,re,Z,U,ae,ee],styles:[".submit-btn[_ngcontent-%COMP%]{margin-top:16px}ion-note[_ngcontent-%COMP%]{margin-left:16px}ion-segment[_ngcontent-%COMP%]{margin-bottom:20px}.map-container[_ngcontent-%COMP%]{margin:20px 0}.map-container[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{width:100%;height:400px;border-radius:8px;margin-bottom:10px}.map-container[_ngcontent-%COMP%]   .map-instruction[_ngcontent-%COMP%]{display:block;text-align:center;margin:10px 0;font-size:.9rem}.map-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin-top:10px}"]});let t=i;return t})();export{Ge as AddressPage};
